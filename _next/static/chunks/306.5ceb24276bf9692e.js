"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[306],{5382:(e,t,r)=>{r.d(t,{B:()=>n});function n(e){return Object.keys(e).forEach(t=>{void 0===e[t]&&delete e[t]}),e}},5306:(e,t,r)=>{r.d(t,{createStaticClient:()=>tx});var n=r(5382);function o(e){return{internalIdToId:e.internalIdToId}}function i(e,t){let{internalIdToId:r}=t;e.internalDocumentIDStore.idToInternalId.clear(),e.internalDocumentIDStore.internalIdToId=[];let n=r.length;for(let t=0;t<n;t++){let n=r[t];e.internalDocumentIDStore.idToInternalId.set(n,t+1),e.internalDocumentIDStore.internalIdToId.push(n)}}function a(e,t){if("string"==typeof t){let r=e.idToInternalId.get(t);if(r)return r;let n=e.idToInternalId.size+1;return e.idToInternalId.set(t,n),e.internalIdToId.push(t),n}return t>e.internalIdToId.length?a(e,t.toString()):t}function l(e,t){if(e.internalIdToId.length<t)throw Error(`Invalid internalId ${t}`);return e.internalIdToId[t-1]}let s={arabic:"ar",armenian:"am",bulgarian:"bg",danish:"dk",dutch:"nl",english:"en",finnish:"fi",french:"fr",german:"de",greek:"gr",hungarian:"hu",indian:"in",indonesian:"id",irish:"ie",italian:"it",lithuanian:"lt",nepali:"np",norwegian:"no",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"rs",slovenian:"ru",spanish:"es",swedish:"se",tamil:"ta",turkish:"tr",ukrainian:"uk",sanskrit:"sk"},u={dutch:/[^A-Za-zàèéìòóù0-9_'-]+/gim,english:/[^A-Za-zàèéìòóù0-9_'-]+/gim,french:/[^a-z0-9äâàéèëêïîöôùüûœç-]+/gim,italian:/[^A-Za-zàèéìòóù0-9_'-]+/gim,norwegian:/[^a-z0-9_æøåÆØÅäÄöÖüÜ]+/gim,portuguese:/[^a-z0-9à-úÀ-Ú]/gim,russian:/[^a-z0-9а-яА-ЯёЁ]+/gim,spanish:/[^a-z0-9A-Zá-úÁ-ÚñÑüÜ]+/gim,swedish:/[^a-z0-9_åÅäÄöÖüÜ-]+/gim,german:/[^a-z0-9A-ZäöüÄÖÜß]+/gim,finnish:/[^a-z0-9äöÄÖ]+/gim,danish:/[^a-z0-9æøåÆØÅ]+/gim,hungarian:/[^a-z0-9áéíóöőúüűÁÉÍÓÖŐÚÜŰ]+/gim,romanian:/[^a-z0-9ăâîșțĂÂÎȘȚ]+/gim,serbian:/[^a-z0-9čćžšđČĆŽŠĐ]+/gim,turkish:/[^a-z0-9çÇğĞıİöÖşŞüÜ]+/gim,lithuanian:/[^a-z0-9ąčęėįšųūžĄČĘĖĮŠŲŪŽ]+/gim,arabic:/[^a-z0-9أ-ي]+/gim,nepali:/[^a-z0-9अ-ह]+/gim,irish:/[^a-z0-9áéíóúÁÉÍÓÚ]+/gim,indian:/[^a-z0-9अ-ह]+/gim,armenian:/[^a-z0-9ա-ֆ]+/gim,greek:/[^a-z0-9α-ωά-ώ]+/gim,indonesian:/[^a-z0-9]+/gim,ukrainian:/[^a-z0-9а-яА-ЯіїєІЇЄ]+/gim,slovenian:/[^a-z0-9čžšČŽŠ]+/gim,bulgarian:/[^a-z0-9а-яА-Я]+/gim,tamil:/[^a-z0-9அ-ஹ]+/gim,sanskrit:/[^a-z0-9A-Zāīūṛḷṃṁḥśṣṭḍṇṅñḻḹṝ]+/gim},c=Object.keys(s);var f=r(2818);let d=Date.now().toString().slice(5),h=0,p=BigInt(1e3),g=BigInt(1e6),m=BigInt(1e9);function y(e,t){if(t.length<65535)Array.prototype.push.apply(e,t);else{let r=t.length;for(let n=0;n<r;n+=65535)Array.prototype.push.apply(e,t.slice(n,n+65535))}}function b(){return BigInt(Math.floor(1e6*performance.now()))}async function I(e){return("number"==typeof e&&(e=BigInt(e)),e<p)?`${e}ns`:e<g?`${e/p}μs`:e<m?`${e/g}ms`:`${e/m}s`}async function w(){var e;return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?b():void 0!==f&&f.release&&"node"===f.release.name||void 0!==f&&"function"==typeof(null==f?void 0:null===(e=f.hrtime)||void 0===e?void 0:e.bigint)?f.hrtime.bigint():"undefined"!=typeof performance?b():BigInt(0)}async function v(){return`${d}-${h++}`}function S(e,t){return void 0===Object.hasOwn?Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0:Object.hasOwn(e,t)?e[t]:void 0}function T(e,t){return t[1]===e[1]?e[0]-t[0]:t[1]-e[1]}function O(e){if(0===e.length)return[];if(1===e.length)return e[0];for(let t=1;t<e.length;t++)if(e[t].length<e[0].length){let r=e[0];e[0]=e[t],e[t]=r}let t=new Map;for(let r of e[0])t.set(r,1);for(let r=1;r<e.length;r++){let n=0;for(let o of e[r]){let e=t.get(o);e===r&&(t.set(o,e+1),n++)}if(0===n)return[]}return e[0].filter(r=>{let n=t.get(r);return void 0!==n&&t.set(r,0),n===e.length})}async function D(e,t){let r={},n=t.length;for(let o=0;o<n;o++){let n=t[o],i=n.split("."),a=e,l=i.length;for(let e=0;e<l;e++)if("object"==typeof(a=a[i[e]])){if(null!==a&&"lat"in a&&"lon"in a&&"number"==typeof a.lat&&"number"==typeof a.lon){a=r[n]=a;break}if(!Array.isArray(a)&&null!==a&&e===l-1){a=void 0;break}}else if((null===a||"object"!=typeof a)&&e<l-1){a=void 0;break}void 0!==a&&(r[n]=a)}return r}async function _(e,t){return(await D(e,[t]))[t]}let k={cm:.01,m:1,km:1e3,ft:.3048,yd:.9144,mi:1609.344};function E(e,t){e.hits=e.hits.map(e=>({...e,document:{...e.document,...t.reduce((e,t)=>{let r=t.split("."),n=r.pop(),o=e;for(let e of r)o[e]=o[e]??{},o=o[e];return o[n]=null,e},e.document)}}))}let N=c.join("\n - "),A={NO_LANGUAGE_WITH_CUSTOM_TOKENIZER:"Do not pass the language option to create when using a custom tokenizer.",LANGUAGE_NOT_SUPPORTED:`Language "%s" is not supported.
Supported languages are:
 - ${N}`,INVALID_STEMMER_FUNCTION_TYPE:"config.stemmer property must be a function.",MISSING_STEMMER:'As of version 1.0.0 @orama/orama does not ship non English stemmers by default. To solve this, please explicitly import and specify the "%s" stemmer from the package @orama/stemmers. See https://docs.oramasearch.com/open-source/text-analysis/stemming for more information.',CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY:"Custom stop words array must only contain strings.",UNSUPPORTED_COMPONENT:'Unsupported component "%s".',COMPONENT_MUST_BE_FUNCTION:'The component "%s" must be a function.',COMPONENT_MUST_BE_FUNCTION_OR_ARRAY_FUNCTIONS:'The component "%s" must be a function or an array of functions.',INVALID_SCHEMA_TYPE:'Unsupported schema type "%s" at "%s". Expected "string", "boolean" or "number" or array of them.',DOCUMENT_ID_MUST_BE_STRING:'Document id must be of type "string". Got "%s" instead.',DOCUMENT_ALREADY_EXISTS:'A document with id "%s" already exists.',DOCUMENT_DOES_NOT_EXIST:'A document with id "%s" does not exists.',MISSING_DOCUMENT_PROPERTY:'Missing searchable property "%s".',INVALID_DOCUMENT_PROPERTY:'Invalid document property "%s": expected "%s", got "%s"',UNKNOWN_INDEX:'Invalid property name "%s". Expected a wildcard string ("*") or array containing one of the following properties: %s',INVALID_BOOST_VALUE:"Boost value must be a number greater than, or less than 0.",INVALID_FILTER_OPERATION:"You can only use one operation per filter, you requested %d.",SCHEMA_VALIDATION_FAILURE:'Cannot insert document due schema validation failure on "%s" property.',INVALID_SORT_SCHEMA_TYPE:'Unsupported sort schema type "%s" at "%s". Expected "string" or "number".',CANNOT_SORT_BY_ARRAY:'Cannot configure sort for "%s" because it is an array (%s).',UNABLE_TO_SORT_ON_UNKNOWN_FIELD:'Unable to sort on unknown field "%s". Allowed fields: %s',SORT_DISABLED:"Sort is disabled. Please read the documentation at https://docs.oramasearch for more information.",UNKNOWN_GROUP_BY_PROPERTY:'Unknown groupBy property "%s".',INVALID_GROUP_BY_PROPERTY:'Invalid groupBy property "%s". Allowed types: "%s", but given "%s".',UNKNOWN_FILTER_PROPERTY:'Unknown filter property "%s".',INVALID_VECTOR_SIZE:'Vector size must be a number greater than 0. Got "%s" instead.',INVALID_VECTOR_VALUE:'Vector value must be a number greater than 0. Got "%s" instead.',INVALID_INPUT_VECTOR:`Property "%s" was declared as a %s-dimensional vector, but got a %s-dimensional vector instead.
Input vectors must be of the size declared in the schema, as calculating similarity between vectors of different sizes can lead to unexpected results.`,WRONG_SEARCH_PROPERTY_TYPE:'Property "%s" is not searchable. Only "string" properties are searchable.',FACET_NOT_SUPPORTED:'Facet doens\'t support the type "%s".',INVALID_DISTANCE_SUFFIX:'Invalid distance suffix "%s". Valid suffixes are: cm, m, km, mi, yd, ft.',INVALID_SEARCH_MODE:'Invalid search mode "%s". Valid modes are: "fulltext", "vector", "hybrid".',MISSING_VECTOR_AND_SECURE_PROXY:"No vector was provided and no secure proxy was configured. Please provide a vector or configure an Orama Secure Proxy to perform hybrid search.",MISSING_TERM:'"term" is a required parameter when performing hybrid search. Please provide a search term.',INVALID_VECTOR_INPUT:'Invalid "vector" property. Expected an object with "value" and "property" properties, but got "%s" instead.',PLUGIN_CRASHED:"A plugin crashed during initialization. Please check the error message for more information:"};function x(e,...t){let r=Error(function(e,...t){return e.replace(/%(?:(?<position>\d+)\$)?(?<width>-?\d*\.?\d*)(?<type>[dfs])/g,function(...e){let{width:r,type:n,position:o}=e[e.length-1],i=o?t[Number.parseInt(o)-1]:t.shift(),a=""===r?0:Number.parseInt(r);switch(n){case"d":return i.toString().padStart(a,"0");case"f":{let e=i,[t,n]=r.split(".").map(e=>Number.parseFloat(e));return"number"==typeof n&&n>=0&&(e=e.toFixed(n)),"number"==typeof t&&t>=0?e.toString().padStart(a,"0"):e.toString()}case"s":return a<0?i.toString().padEnd(-a," "):i.toString().padStart(a," ");default:return i}})}(A[e]??`Unsupported Orama Error code: ${e}`,...t));return r.code=e,"captureStackTrace"in Error.prototype&&Error.captureStackTrace(r),r}let R="fulltext";function P(e,t,r=0,n){let o;if(0===t)throw x("INVALID_BOOST_VALUE");let i=new Map,a=e.length;for(let r=0;r<a;r++){let n=e[r],o=n.length;for(let e=0;e<o;e++){var l,s;let[r,o]=n[e],a=o*t,u=null===(l=i.get(r))||void 0===l?void 0:l[0];void 0!==u?i.set(r,[1.5*u+a,((null===(s=null==i?void 0:i.get(r))||void 0===s?void 0:s[1])||0)+1]):i.set(r,[a,1])}}let u=[];for(let e of i.entries())u.push([e[0],e[1][0]]);let c=u.sort((e,t)=>t[1]-e[1]);if(1===r)return c;let f=c.length,d=[];for(let e of i.entries())d.push([e[0],e[1][0],e[1][1]]);let h=d.sort((e,t)=>e[2]>t[2]?-1:e[2]<t[2]?1:e[1]>t[1]?-1:e[1]<t[1]?1:0);for(let e=0;e<f;e++)if(h[e][2]===n)o=e;else break;if(void 0===o){if(0===r)return[];o=0}let p=h.length,g=Array(p);for(let e=0;e<p;e++)g[e]=[h[e][0],h[e][1]];if(0===r)return g.slice(0,o+1);let m=o+Math.ceil(100*r*(f-o)/100);return g.slice(0,f+m)}function M(e,t){return e[1]-t[1]}function U(e,t){return t[1]-e[1]}async function z(e,t,r){let n={},o=t.map(([e])=>e),i=await e.documentsStore.getMultiple(e.data.docs,o),a=Object.keys(r),l=await e.index.getSearchablePropertiesWithTypes(e.data.index);for(let e of a){let t;if("number"===l[e]){let{ranges:n}=r[e],o=n.length,i=Array.from({length:o});for(let e=0;e<o;e++){let t=n[e];i[e]=[`${t.from}-${t.to}`,0]}t=Object.fromEntries(i)}n[e]={count:0,values:t??{}}}let s=i.length;for(let e=0;e<s;e++){let t=i[e];for(let e of a){let o=e.includes(".")?await _(t,e):t[e],i=l[e],a=n[e].values;switch(i){case"number":C(r[e].ranges,a)(o);break;case"number[]":{let t=new Set,n=C(r[e].ranges,a,t);for(let e of o)n(e);break}case"boolean":case"enum":case"string":L(a,i)(o);break;case"boolean[]":case"enum[]":case"string[]":{let e=L(a,"boolean[]"===i?"boolean":"string",new Set);for(let t of o)e(t);break}default:throw x("FACET_NOT_SUPPORTED",i)}}}for(let e of a){let t=n[e];if(t.count=Object.keys(t.values).length,"string"===l[e]){let n=r[e],o=function(e="desc"){return"asc"===e.toLowerCase()?M:U}(n.sort);t.values=Object.fromEntries(Object.entries(t.values).sort(o).slice(n.offset??0,n.limit??10))}}return n}function C(e,t,r){return n=>{for(let o of e){let e=`${o.from}-${o.to}`;(null==r||!r.has(e))&&n>=o.from&&n<=o.to&&(void 0===t[e]?t[e]=1:(t[e]++,null==r||r.add(e)))}}}function L(e,t,r){let n="boolean"===t?"false":"";return t=>{let o=(null==t?void 0:t.toString())??n;null!=r&&r.has(o)||(e[o]=(e[o]??0)+1,null==r||r.add(o))}}function j(e,t){let r=new Map,n=[];for(let t of e)r.set(t,!0);for(let e of t){let[t]=e;r.has(t)&&(n.push(e),r.delete(t))}return n}let B={reducer:(e,t,r,n)=>(t[n]=r,t),getInitialValue:e=>Array.from({length:e})},V=["string","number","boolean"];async function W(e,t,r){let n=r.properties,o=n.length,i=await e.index.getSearchablePropertiesWithTypes(e.data.index);for(let e=0;e<o;e++){let t=n[e];if(void 0===i[t])throw x("UNKNOWN_GROUP_BY_PROPERTY",t);if(!V.includes(i[t]))throw x("INVALID_GROUP_BY_PROPERTY",t,V.join(", "),i[t])}let a=t.map(([t])=>l(e.internalDocumentIDStore,t)),s=await e.documentsStore.getMultiple(e.data.docs,a),u=s.length,c=r.maxResult||Number.MAX_SAFE_INTEGER,f=[],d={};for(let e=0;e<o;e++){let t=n[e],r={property:t,perValue:{}},o=new Set;for(let e=0;e<u;e++){let n=s[e],i=await _(n,t);if(void 0===i)continue;let a="boolean"!=typeof i?i:""+i,l=r.perValue[a]??{indexes:[],count:0};l.count>=c||(l.indexes.push(e),l.count++,r.perValue[a]=l,o.add(i))}f.push(Array.from(o)),d[t]=r}let h=function e(t,r=0){if(r+1===t.length)return t[r].map(e=>[e]);let n=t[r],o=e(t,r+1),i=[];for(let e of n)for(let t of o){let r=[e];y(r,t),i.push(r)}return i}(f),p=h.length,g=[];for(let e=0;e<p;e++){let t=h[e],r=t.length,o={values:[],indexes:[]},i=[];for(let e=0;e<r;e++){let r=t[e],a=n[e];i.push(d[a].perValue["boolean"!=typeof r?r:""+r].indexes),o.values.push(r)}o.indexes=O(i).sort((e,t)=>e-t),0!==o.indexes.length&&g.push(o)}let m=g.length,b=Array.from({length:m});for(let e=0;e<m;e++){let n=g[e],o=r.reduce||B,i=n.indexes.map(e=>({id:a[e],score:t[e][1],document:s[e]})),l=o.reducer.bind(null,n.values),u=o.getInitialValue(n.indexes.length),c=i.reduce(l,u);b[e]={values:n.values,result:c}}return b}let F=["tokenizer","index","documentsStore","sorter"],$=["validateSchema","getDocumentIndexId","getDocumentProperties","formatElapsedTime"];async function Y(e,t,r,n,o){let i=e.length;for(let a=0;a<i;a++)await e[a](t,r,n,o)}async function G(e,t,r,n){let o=e.length;for(let i=0;i<o;i++)await e[i](t,r,n)}async function q(e,t){let r=e.length;for(let n=0;n<r;n++)await e[n](t)}async function K(e,t,r){let n;let o=await w();e.beforeSearch&&await G(e.beforeSearch,e,t,r),t.relevance=Object.assign(en,t.relevance??{});let i=Object.keys(e.data.index.vectorIndexes),l=t.facets&&Object.keys(t.facets).length>0,{limit:s=10,offset:u=0,term:c,properties:f,threshold:d=0,distinctOn:h,includeVectors:p=!1}=t,g=!0===t.preflight,{index:m,docs:b}=e.data,I=await e.tokenizer.tokenize(c??"",r),v=e.caches.propertiesToSearch;if(!v){let t=await e.index.getSearchablePropertiesWithTypes(m);v=(v=await e.index.getSearchableProperties(m)).filter(e=>t[e].startsWith("string")),e.caches.propertiesToSearch=v}if(f&&"*"!==f){for(let e of f)if(!v.includes(e))throw x("UNKNOWN_INDEX",e,v.join(", "));v=v.filter(e=>f.includes(e))}let S=await eo(e.tokenizer,e.index,e.documentsStore,r,t,v,I,await e.documentsStore.count(b),o),O=Object.keys(t.where??{}).length>0,D=[];O&&(D=await e.index.searchByWhereClause(S,m,t.where));let _=I.length;if(_||(null==f?void 0:f.length)){let r=v.length;for(let n=0;n<r;n++){var k;let r=v[n],o=S.indexMap[r];if(0!==_)for(let t=0;t<_;t++){let n=I[t],i=await e.index.search(S,m,r,n);y(o[n],i)}else{o[""]=[];let t=await e.index.search(S,m,r,"");y(o[""],t)}let i=Object.values(o);S.docsIntersection[r]=P(i,(null==t?void 0:null===(k=t.boost)||void 0===k?void 0:k[r])??1,d,_);let a=S.docsIntersection[r],l=a.length;for(let e=0;e<l;e++){let[t,r]=a[e],n=S.uniqueDocsIDs[t];n?S.uniqueDocsIDs[t]=n+r+.5:S.uniqueDocsIDs[t]=r}}}else 0===I.length&&c?S.uniqueDocsIDs={}:S.uniqueDocsIDs=Object.fromEntries(Object.keys(await e.documentsStore.getAll(e.data.docs)).map(e=>[e,0]));let N=Object.entries(S.uniqueDocsIDs).map(([e,t])=>[+e,t]);if(O&&(N=j(D,N)),t.sortBy){if("function"==typeof t.sortBy){let r=N.map(([e])=>e),n=(await e.documentsStore.getMultiple(e.data.docs,r)).map((e,t)=>[N[t][0],N[t][1],e]);n.sort(t.sortBy),N=n.map(([e,t])=>[e,t])}else N=await e.sorter.sortBy(e.data.sorting,N,t.sortBy).then(t=>t.map(([t,r])=>[a(e.internalDocumentIDStore,t),r]))}else N=N.sort(T);g||(n=await (h?ea(e,N,u,s,h):el(e,N,u,s)));let A={elapsed:{formatted:"",raw:0},hits:[],count:N.length};if(void 0===n||(A.hits=n.filter(Boolean),p||E(A,i)),l){let r=await z(e,N,t.facets);A.facets=r}return t.groupBy&&(A.groups=await W(e,N,t.groupBy)),e.afterSearch&&await Y(e.afterSearch,e,t,r,A),A.elapsed=await e.formatElapsedTime(await w()-S.timeStart),A}function H(e,t){let r=0;for(let n=0;n<t;n++)r+=e[n]*e[n];return Math.sqrt(r)}function X(e,t,r,n=.8){let o=H(e,r),i=[];for(let[a,[l,s]]of Object.entries(t)){let t=0;for(let n=0;n<r;n++)t+=e[n]*s[n];let u=t/(o*l);u>=n&&i.push([a,u])}return i.sort((e,t)=>t[1]-e[1])}async function Z(e,t,r="english"){let n=await w();e.beforeSearch&&await G(e.beforeSearch,e,t,r);let{vector:o}=t;if(o&&(!("value"in o)||!("property"in o)))throw x("INVALID_VECTOR_INPUT",Object.keys(o).join(", "));let{limit:i=10,offset:s=0,includeVectors:u=!1}=t,c=e.data.index.vectorIndexes[o.property],f=c.size,d=c.vectors,h=t.facets&&Object.keys(t.facets).length>0,p=Object.keys(t.where??{}).length>0,{index:g,docs:m}=e.data;if((null==o?void 0:o.value.length)!==f)throw x("INVALID_INPUT_VECTOR",null==o?void 0:o.property,f,null==o?void 0:o.value.length);o instanceof Float32Array||(o.value=new Float32Array(o.value));let y=X(o.value,d,f,t.similarity).map(([t,r])=>[a(e.internalDocumentIDStore,t),r]),b=e.caches.propertiesToSearch;if(!b){let t=await e.index.getSearchablePropertiesWithTypes(g);b=(b=await e.index.getSearchableProperties(g)).filter(e=>t[e].startsWith("string")),e.caches.propertiesToSearch=b}let v=await eo(e.tokenizer,e.index,e.documentsStore,r,t,b,[],await e.documentsStore.count(m),n);p&&(y=j(await e.index.searchByWhereClause(v,g,t.where),y));let S=[];h&&(S=await z(e,y,t.facets));let T=Array.from({length:i});for(let t=0;t<i;t++){let r=y[t+s];if(!r)break;let n=e.data.docs.docs[r[0]];if(n){u||(n[o.property]=null);let i={id:l(e.internalDocumentIDStore,r[0]),score:r[1],document:n};T[t]=i}}let O=[];t.groupBy&&(O=await W(e,y,t.groupBy)),e.afterSearch&&await Y(e.afterSearch,e,t,r,y);let D=await w()-n;return{count:y.length,hits:T.filter(Boolean),elapsed:{raw:Number(D),formatted:await I(D)},...S?{facets:S}:{},...O?{groups:O}:{}}}async function J(e,t,r){let n,o;let i=await w();e.beforeSearch&&await G(e.beforeSearch,e,t,r);let{offset:a=0,limit:l=10,includeVectors:s=!1}=t,u=t.facets&&Object.keys(t.facets).length>0,[c,f]=await Promise.all([Q(e,t,r),ee(e,t)]),{index:d,docs:h}=e.data,p=t.hybridWeights,g=function(e,t,r,n){let o=Math.max.apply(Math,e.map(et)),i=Math.max.apply(Math,t.map(et)),{text:a,vector:l}=n&&n.text&&n.vector?n:{text:.5,vector:.5},s=new Map,u=e.length,c=(e,t)=>e*a+t*l;for(let t=0;t<u;t++){let[r,n]=e[t],i=c(n/o,0);s.set(r,i)}let f=t.length;for(let e=0;e<f;e++){let[r,n]=t[e],o=n/i,a=s.get(r)??0;s.set(r,a+c(0,o))}return[...s].sort((e,t)=>t[1]-e[1])}(c,f,t.term,p),m=await e.tokenizer.tokenize(t.term??"",r),y=e.caches.propertiesToSearch;if(!y){let t=await e.index.getSearchablePropertiesWithTypes(d);y=(y=await e.index.getSearchableProperties(d)).filter(e=>t[e].startsWith("string")),e.caches.propertiesToSearch=y}if(t.properties&&"*"!==t.properties){for(let e of t.properties)if(!y.includes(e))throw x("UNKNOWN_INDEX",e,y.join(", "));y=y.filter(e=>t.properties.includes(e))}let b=await eo(e.tokenizer,e.index,e.documentsStore,r,t,y,m,await e.documentsStore.count(h),i),v=Object.keys(t.where??{}).length>0;v&&(g=j(await e.index.searchByWhereClause(b,d,t.where),g)),u&&(n=await z(e,g,t.facets)),t.groupBy&&(o=await W(e,g,t.groupBy));let S=(await el(e,g,a,l)).filter(Boolean);e.afterSearch&&await Y(e.afterSearch,e,t,r,S);let T=await w(),O={count:g.length,elapsed:{raw:Number(T-i),formatted:await I(T-i)},hits:S,...n?{facets:n}:{},...o?{groups:o}:{}};return s||E(O,Object.keys(e.data.index.vectorIndexes)),O}async function Q(e,t,r){let n=await w();t.relevance=Object.assign(en,t.relevance??{});let{term:o="",properties:i,threshold:a=0}=t,{index:l,docs:s}=e.data,u=await e.tokenizer.tokenize(o,r),c=e.caches.propertiesToSearch;if(!c){let t=await e.index.getSearchablePropertiesWithTypes(l);c=(c=await e.index.getSearchableProperties(l)).filter(e=>t[e].startsWith("string")),e.caches.propertiesToSearch=c}if(i&&"*"!==i){let e=new Set(c),t=new Set(i);for(let t of i)if(!e.has(t))throw x("UNKNOWN_INDEX",t,c.join(", "));c=c.filter(e=>t.has(e))}let f=await eo(e.tokenizer,e.index,e.documentsStore,r,t,c,u,await e.documentsStore.count(s),n),d=u.length;if(d||i&&i.length>0){let r=c.length;for(let n=0;n<r;n++){var h;let r=c[n];if(0!==d)for(let t=0;t<d;t++){let n=u[t],o=await e.index.search(f,l,r,n);y(f.indexMap[r][n],o)}else{let t=[];f.indexMap[r][""]=t,y(t,await e.index.search(f,l,r,""))}let o=Object.values(f.indexMap[r]);f.docsIntersection[r]=P(o,(null==t?void 0:null===(h=t.boost)||void 0===h?void 0:h[r])??1,a,d);let i=f.docsIntersection[r],s=i.length;for(let e=0;e<s;e++){let[t,r]=i[e],n=f.uniqueDocsIDs[t];f.uniqueDocsIDs[t]=n?n+r+.5:r}}}else 0===u.length&&o?f.uniqueDocsIDs={}:f.uniqueDocsIDs=Object.fromEntries(Object.keys(await e.documentsStore.getAll(e.data.docs)).map(e=>[e,0]));return er(Object.entries(f.uniqueDocsIDs).map(([e,t])=>[+e,t]).sort((e,t)=>t[1]-e[1]))}async function ee(e,t){let r=t.vector,n=e.data.index.vectorIndexes[null==r?void 0:r.property],o=n.size,i=n.vectors;if(r&&(!r.value||!r.property))throw x("INVALID_VECTOR_INPUT",Object.keys(r).join(", "));if(r.value.length!==o)throw x("INVALID_INPUT_VECTOR",r.property,o,r.value.length);return r instanceof Float32Array||(r.value=new Float32Array(r.value)),er(X(r.value,i,o,t.similarity).map(([t,r])=>[a(e.internalDocumentIDStore,t),r]))}function et([,e]){return e}function er(e){let t=Math.max.apply(Math,e.map(et));return e.map(([e,r])=>[e,r/t])}let en={k:1.2,b:.75,d:.5};async function eo(e,t,r,n,o,i,a,l,s){let u={},c={};for(let e of i){let t={};for(let e of a)t[e]=[];u[e]=t,c[e]=[]}return{timeStart:s,tokenizer:e,index:t,documentsStore:r,language:n,params:o,docsCount:l,uniqueDocsIDs:{},indexMap:u,docsIntersection:c}}async function ei(e,t,r){let n=t.mode??R;if(n===R)return K(e,t,r);if("vector"===n)return Z(e,t);if("hybrid"===n)return J(e,t);throw x("INVALID_SEARCH_MODE",n)}async function ea(e,t,r,n,o){let i=e.data.docs,a=new Map,s=[],u=new Set,c=t.length,f=0;for(let d=0;d<c;d++){let c=t[d];if(void 0===c)continue;let[h,p]=c;if(u.has(h))continue;let g=await e.documentsStore.get(i,h),m=await _(g,o);if(!(void 0===m||a.has(m))&&(a.set(m,!0),!(++f<=r)&&(s.push({id:l(e.internalDocumentIDStore,h),score:p,document:g}),u.add(h),f>=r+n)))break}return s}async function el(e,t,r,n){let o=e.data.docs,i=Array.from({length:n}),a=new Set;for(let s=r;s<n+r;s++){let r=t[s];if(void 0===r)break;let[n,u]=r;if(!a.has(n)){let t=await e.documentsStore.get(o,n);i[s]={id:l(e.internalDocumentIDStore,n),score:u,document:t},a.add(n)}}return i}async function es(e,t,r={}){return(await ei(e,{term:t,tolerance:1,...r,boost:{title:2,..."boost"in r?r.boost:void 0}})).hits.map(e=>({type:"page",content:e.document.title,id:e.document.url,url:e.document.url}))}async function eu(e,t,r,o={}){let i={where:(0,n.B)({tag:r,...o.where}),groupBy:{properties:["page_id"],maxResult:8,...o.groupBy}};t.length>0&&(i={...i,term:t,properties:["content","keywords"],...o,where:i.where,groupBy:i.groupBy});let a=await ei(e,i),l=[];for(let t of a.groups??[]){let r=t.values[0],n=await e.documentsStore.get(e.data.docs,r);if(n)for(let e of(l.push({id:r,type:"page",content:n.content,url:n.url}),t.result))"page"!==e.document.type&&l.push({id:e.document.id.toString(),content:e.document.content,type:e.document.type,url:e.document.url})}return l}async function ec(e){return{raw:Number(e),formatted:await I(e)}}async function ef(e){if(e.id){if("string"!=typeof e.id)throw x("DOCUMENT_ID_MUST_BE_STRING",typeof e.id);return e.id}return await v()}async function ed(e,t){for(let[r,n]of Object.entries(t)){let t=e[r];if(void 0!==t&&("geopoint"!==n||"object"!=typeof t||"number"!=typeof t.lon||"number"!=typeof t.lat)&&("enum"!==n||"string"!=typeof t&&"number"!=typeof t)){if("enum[]"===n&&Array.isArray(t)){let e=t.length;for(let n=0;n<e;n++)if("string"!=typeof t[n]&&"number"!=typeof t[n])return r+"."+n;continue}if(eg(n)){let e=ey(n);if(!Array.isArray(t)||t.length!==e)throw x("INVALID_INPUT_VECTOR",r,e,t.length);continue}if(em(n)){if(!Array.isArray(t))return r;let e=ep[n],o=t.length;for(let n=0;n<o;n++)if(typeof t[n]!==e)return r+"."+n;continue}if("object"==typeof n){if(!t||"object"!=typeof t)return r;let e=await ed(t,n);if(e)return r+"."+e;continue}if(typeof t!==n)return r}}}r(2346);let eh={string:!1,number:!1,boolean:!1,enum:!1,geopoint:!1,"string[]":!0,"number[]":!0,"boolean[]":!0,"enum[]":!0},ep={"string[]":"string","number[]":"number","boolean[]":"boolean","enum[]":"enum"};function eg(e){return"string"==typeof e&&/^vector\[\d+\]$/.test(e)}function em(e){return"string"==typeof e&&eh[e]}function ey(e){let t=Number(e.slice(7,-1));switch(!0){case isNaN(t):throw x("INVALID_VECTOR_VALUE",e);case t<=0:throw x("INVALID_VECTOR_SIZE",e);default:return t}}async function eb(e,t){return{sharedInternalDocumentStore:t,docs:{},count:0}}async function eI(e,t){let r=a(e.sharedInternalDocumentStore,t);return e.docs[r]}async function ew(e,t){let r=t.length,n=Array.from({length:r});for(let o=0;o<r;o++){let r=a(e.sharedInternalDocumentStore,t[o]);n[o]=e.docs[r]}return n}async function ev(e){return e.docs}async function eS(e,t,r){let n=a(e.sharedInternalDocumentStore,t);return void 0===e.docs[n]&&(e.docs[n]=r,e.count++,!0)}async function eT(e,t){let r=a(e.sharedInternalDocumentStore,t);return void 0!==e.docs[r]&&(delete e.docs[r],e.count--,!0)}async function eO(e){return e.count}async function eD(e,t){return{docs:t.docs,count:t.count,sharedInternalDocumentStore:e}}async function e_(e){return{docs:e.docs,count:e.count}}async function ek(){return{create:eb,get:eI,getMultiple:ew,getAll:ev,store:eS,remove:eT,count:eO,load:eD,save:e_}}let eE=["beforeInsert","afterInsert","beforeRemove","afterRemove","beforeUpdate","afterUpdate","beforeSearch","afterSearch","beforeInsertMultiple","afterInsertMultiple","beforeRemoveMultiple","afterRemoveMultiple","beforeUpdateMultiple","afterUpdateMultiple","beforeLoad","afterLoad","afterCreate"];async function eN(e,t){var r;let n=[],o=null===(r=e.plugins)||void 0===r?void 0:r.length;if(!o)return n;for(let r=0;r<o;r++)try{let o=await e.plugins[r];"function"==typeof o[t]&&n.push(o[t])}catch(e){throw console.error("Caught error in getAllPluginsByHook:",e),x("PLUGIN_CRASHED")}return n}function eA(e){let t=e.r;return e.r=t.l,t.l=e,e.h=Math.max(ez(e.l),ez(e.r))+1,t.h=Math.max(ez(t.l),ez(t.r))+1,t}function ex(e){let t=e.l;return e.l=t.r,t.r=e,e.h=Math.max(ez(e.l),ez(e.r))+1,t.h=Math.max(ez(t.l),ez(t.r))+1,t}function eR(e,t,r=!1){let n=[];if(null===e)return n;let o=[e.root];for(;o.length>0;){let e=o.pop();e&&(r&&e.k>=t&&y(n,e.v),!r&&e.k>t&&y(n,e.v),o.push(e.r),o.push(e.l))}return n}function eP(e,t,r=!1){let n=[];if(null===e)return n;let o=[e.root];for(;o.length>0;){let e=o.pop();e&&(r&&e.k<=t&&y(n,e.v),!r&&e.k<t&&y(n,e.v),o.push(e.r),o.push(e.l))}return n}function eM(e,t){for(;null!==e;)if(t<e.k)e=e.l;else{if(!(t>e.k))return e;e=e.r}return null}let eU=0;function ez(e){return null!==e?e.h:-1}function eC(e,t){let r=Object.keys(t);if(1!==r.length)throw Error("Invalid operation");let n=r[0];switch(n){case"eq":{let r=t[n];return e.numberToDocumentId.get(r)??[]}case"in":{let r=t[n],o=[];for(let t of r){let r=e.numberToDocumentId.get(t);null!=r&&y(o,r)}return o}case"nin":{let r=t[n],o=[];for(let t of e.numberToDocumentId.keys()){if(r.includes(t))continue;let n=e.numberToDocumentId.get(t);null!=n&&y(o,n)}return o}}throw Error("Invalid operation")}function eL(e,t){let r=Object.keys(t);if(1!==r.length)throw Error("Invalid operation");let n=r[0];if("containsAll"===n)return O(t[n].map(t=>e.numberToDocumentId.get(t)??[]));throw Error("Invalid operation")}function ej(e,t,r){let n=function(e,t,r){if(r<0)return -1;if(e===t)return 0;let n=e.length,o=t.length;if(0===n)return o<=r?o:-1;if(0===o)return n<=r?n:-1;if(e=e.toLowerCase(),(t=t.toLowerCase()).startsWith(e)||e.startsWith(t))return 0;if(Math.abs(n-o)>r)return -1;let i=[];for(let e=0;e<=n;e++){i[e]=[e];for(let t=1;t<=o;t++)i[e][t]=0===e?t:0}for(let a=1;a<=n;a++){let n=1/0;for(let r=1;r<=o;r++)e[a-1]===t[r-1]?i[a][r]=i[a-1][r-1]:i[a][r]=Math.min(i[a-1][r]+1,i[a][r-1]+1,i[a-1][r-1]+1),n=Math.min(n,i[a][r]);if(n>r)return -1}return i[n][o]<=r?i[n][o]:-1}(e,t,r);return{distance:n,isBounded:n>=0}}class eB{constructor(e,t,r){this.k=e,this.s=t,this.e=r}c={};d=[];w="";toJSON(){return{w:this.w,s:this.s,c:this.c,d:this.d,e:this.e}}}function eV(e,t){e.w=t.w+e.s}function eW(e,t){e.d.push(t)}function eF(e,t,r,n,o){if(e.e){let{w:i,d:a}=e;if(n&&i!==r)return{};if(null==S(t,i)&&(o?Math.abs(r.length-i.length)<=o&&ej(r,i,o).isBounded&&(t[i]=[]):t[i]=[]),null!=S(t,i)&&a.length>0){let e=new Set(t[i]),r=a.length;for(let t=0;t<r;t++)e.add(a[t]);t[i]=Array.from(e)}}for(let i of Object.keys(e.c))eF(e.c[i],t,r,n,o);return t}function e$(e,t){let r="",n=Math.min(e.length,t.length);for(let o=0;o<n&&e[o]===t[o];o++)r+=e[o];return r}function eY(e=!1,t="",r=""){return new eB(r,t,e)}function eG(e,{term:t,exact:r,tolerance:n}){if(n&&!r){let r={};return!function e(t,r,n,o,i,a){if(!(o<0)){if(t.w.startsWith(r)){eF(t,a,r,!1,0);return}if(t.e){let{w:e,d:n}=t;if(e&&(ej(r,e,i).isBounded&&(a[e]=[]),null!=S(a,e)&&n.length>0)){let t=new Set(a[e]),r=n.length;for(let e=0;e<r;e++)t.add(n[e]);a[e]=Array.from(t)}}if(!(n>=r.length)){for(let l in r[n]in t.c&&e(t.c[r[n]],r,n+1,o,i,a),e(t,r,n+1,o-1,i,a),t.c)e(t.c[l],r,n,o-1,i,a);for(let l in t.c)l!==r[n]&&e(t.c[l],r,n+1,o-1,i,a)}}}(e,t,0,(n=n||0)||0,n,r),r}{let o=t.length;for(let r=0;r<o;r++){let o=t[r];if(!(o in e.c))return{};{let i=e.c[o],a=i.s,l=t.substring(r),s=e$(a,l).length;if(s!==a.length&&s!==l.length){if(n)break;return{}}r+=i.s.length-1,e=i}}let i={};return eF(e,i,t,r,n),i}}function eq(e,t){let r=Math.PI/180,n=e.lat*r,o=t.lat*r,i=(t.lat-e.lat)*r,a=(t.lon-e.lon)*r,l=Math.sin(i/2)*Math.sin(i/2)+Math.cos(n)*Math.cos(o)*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3}function eK(e,t){let r,n,o,i,a,l;let s=1/298.257223563,u=(1-1/298.257223563)*6378137,c=Math.PI/180,f=e.lat*c,d=t.lat*c,h=(t.lon-e.lon)*c,p=Math.atan((1-s)*Math.tan(f)),g=Math.atan((1-s)*Math.tan(d)),m=Math.sin(p),y=Math.cos(p),b=Math.sin(g),I=Math.cos(g),w=h,v=1e3;do{let e=Math.sin(w),t=Math.cos(w);l=Math.atan2(i=Math.sqrt(I*e*(I*e)+(y*b-m*I*t)*(y*b-m*I*t)),a=m*b+y*I*t);let u=a-2*m*b/(o=1-(n=y*I*e/i)*n),c=s/16*o*(4+s*(4-3*o));r=w,w=h+(1-c)*s*n*(l+c*i*(u+c*a*(-1+2*u*u)))}while(Math.abs(w-r)>1e-12&&--v>0);let S=o*(0x24ffb2985f71-u*u)/(u*u),T=S/1024*(256+S*(-128+S*(74-47*S))),O=T*i*(a-2*m*b/o+T/4*(a*(-1+2*i*i)-T/6*l*(-3+4*i*i)*(-3+4*l*l)));return u*(1+S/16384*(4096+S*(-768+S*(320-175*S))))*(l-O)}async function eH(e,t,r,n,o){let i=a(e.sharedInternalDocumentStore,r);e.avgFieldLength[t]=((e.avgFieldLength[t]??0)*(o-1)+n.length)/o,e.fieldLengths[t][i]=n.length,e.frequencies[t][i]={}}async function eX(e,t,r,n,o){let i=0;for(let e of n)e===o&&i++;let l=a(e.sharedInternalDocumentStore,r),s=i/n.length;e.frequencies[t][l][o]=s,o in e.tokenOccurrences[t]||(e.tokenOccurrences[t][o]=0),e.tokenOccurrences[t][o]=(e.tokenOccurrences[t][o]??0)+1}async function eZ(e,t,r,n){let o=a(e.sharedInternalDocumentStore,r);n>1?e.avgFieldLength[t]=(e.avgFieldLength[t]*n-e.fieldLengths[t][o])/(n-1):e.avgFieldLength[t]=void 0,e.fieldLengths[t][o]=void 0,e.frequencies[t][o]=void 0}async function eJ(e,t,r){e.tokenOccurrences[t][r]--}async function eQ(e,t,r,n,o){let i=Array.from(o),l=t.avgFieldLength[r],s=t.fieldLengths[r],u=t.tokenOccurrences[r],c=t.frequencies[r],f="number"==typeof u[n]?u[n]??0:0,d=[],h=i.length;for(let r=0;r<h;r++){var p;let o=a(t.sharedInternalDocumentStore,i[r]),u=function(e,t,r,n,o,{k:i,b:a,d:l}){return Math.log(1+(r-t+.5)/(t+.5))*(l+e*(i+1))/(e+i*(1-a+a*n/o))}((null==c?void 0:null===(p=c[o])||void 0===p?void 0:p[n])??0,f,e.docsCount,s[o],l,e.params.relevance);d.push([o,u])}return d}async function e0(e,t,r,n,o=""){for(let[i,a]of(n||(n={sharedInternalDocumentStore:t,indexes:{},vectorIndexes:{},searchableProperties:[],searchablePropertiesWithTypes:{},frequencies:{},tokenOccurrences:{},avgFieldLength:{},fieldLengths:{}}),Object.entries(r))){let r=`${o}${o?".":""}${i}`;if("object"==typeof a&&!Array.isArray(a)){e0(e,t,a,n,r);continue}if(eg(a))n.searchableProperties.push(r),n.searchablePropertiesWithTypes[r]=a,n.vectorIndexes[r]={size:ey(a),vectors:{}};else{let e=/\[/.test(a);switch(a){case"boolean":case"boolean[]":n.indexes[r]={type:"Bool",node:{true:[],false:[]},isArray:e};break;case"number":case"number[]":n.indexes[r]={type:"AVL",node:{root:{k:0,v:[],l:null,r:null,h:0}},isArray:e};break;case"string":case"string[]":n.indexes[r]={type:"Radix",node:eY(),isArray:e},n.avgFieldLength[r]=0,n.frequencies[r]={},n.tokenOccurrences[r]={},n.fieldLengths[r]={};break;case"enum":case"enum[]":n.indexes[r]={type:"Flat",node:{numberToDocumentId:new Map},isArray:e};break;case"geopoint":n.indexes[r]={type:"BKD",node:{root:null},isArray:e};break;default:throw x("INVALID_SCHEMA_TYPE",Array.isArray(a)?"array":a,r)}n.searchableProperties.push(r),n.searchablePropertiesWithTypes[r]=a}}return n}async function e1(e,t,r,n,o,i,l,s,u,c){if(eg(i))return function(e,t,r,n){r instanceof Float32Array||(r=new Float32Array(r));let o=H(r,e.vectorIndexes[t].size);e.vectorIndexes[t].vectors[n]=[o,r]}(t,r,o,n);let f=async o=>{let i=a(t.sharedInternalDocumentStore,n),{type:f,node:d}=t.indexes[r];switch(f){case"Bool":d[o?"true":"false"].push(i);break;case"AVL":!function(e,t,r,n=500){e.root=function e(t,r,o){if(null===t)return eU++,{k:r,v:o,l:null,r:null,h:0};if(r<t.k)t.l=e(t.l,r,o);else{if(!(r>t.k))return t.v.push(...o),t;t.r=e(t.r,r,o)}return eU%n==0?function(e,t){e.h=1+Math.max(ez(e.l),ez(e.r));let r=ez(e.l)-ez(e.r);return r>1&&t<e.l.k?ex(e):r<-1&&t>e.r.k?eA(e):r>1&&t>e.l.k?(e.l=eA(e.l),ex(e)):r<-1&&t<e.r.k?(e.r=ex(e.r),eA(e)):e}(t,r):t}(e.root,t,r)}(d,o,[i],(null==c?void 0:c.avlRebalanceThreshold)??1);break;case"Radix":{let n=await s.tokenize(o,l,r);for(let o of(await e.insertDocumentScoreParameters(t,r,i,n,u),n))await e.insertTokenScoreParameters(t,r,i,n,o),function(e,t,r){let n=t.length;for(let o=0;o<n;o++){let n=t[o],i=t.substring(o),a=e.c[n];if(a){let l=a.s,s=l.length,u=e$(l,i),c=u.length;if(l===i){eW(a,r),a.e=!0;return}let f=l[c];if(c<s&&c===i.length){let t=eY(!0,i,n);t.c[f]=a;let o=t.c[f];o.s=l.substring(c),o.k=f,e.c[n]=t,eV(t,e),eV(o,t),eW(t,r);return}if(c<s&&c<i.length){let s=eY(!1,u,n);s.c[f]=a,e.c[n]=s;let d=s.c[f];d.s=l.substring(c),d.k=f;let h=i[c],p=eY(!0,t.substring(o+c),h);eW(p,r),s.c[h]=p,eV(s,e),eV(p,s),eV(d,s);return}o+=s-1,e=a}else{let t=eY(!0,i,n);eW(t,r),e.c[n]=t,eV(t,e);return}}}(d,o,i);break}case"Flat":d.numberToDocumentId.has(o)?d.numberToDocumentId.get(o).push(i):d.numberToDocumentId.set(o,[i]);break;case"BKD":!function(e,t,r){let n={point:t,docIDs:r};if(null==e.root){e.root=n;return}let o=e.root,i=0;for(;null!==o;){if(o.point.lon===t.lon&&o.point.lat===t.lat){let e=o.docIDs??[];o.docIDs=Array.from(new Set([...e,...r||[]]));return}if(0==i%2){if(t.lon<o.point.lon){if(null==o.left){o.left=n;return}o=o.left}else{if(null==o.right){o.right=n;return}o=o.right}}else if(t.lat<o.point.lat){if(null==o.left){o.left=n;return}o=o.left}else{if(null==o.right){o.right=n;return}o=o.right}i++}}(d,o,[i])}};if(!em(i))return f(o);let d=o.length;for(let e=0;e<d;e++)await f(o[e])}async function e9(e,t,r,n,o,i,l,s,u){let c=a(t.sharedInternalDocumentStore,n);if(eg(i))return delete t.vectorIndexes[r].vectors[n],!0;let{type:f,node:d}=t.indexes[r];switch(f){case"AVL":return!function(e,t,r){let n=eM(e.root,r);if(n){if(1===n.v.length){!function(e,t){if(null===e||null===e.root)return;let r=e.root,n=null;for(;null!=r&&r.k!==t;)n=r,r=t<r.k?r.l:r.r;null!==r&&(()=>{if(null===r.l&&null===r.r)null===n?e.root=null:n.l===r?n.l=null:n.r=null;else if(null!=r.l&&null!=r.r){let e=r.r,t=r;for(;null!=e.l;)t=e,e=e.l;r.k=e.k,t===r?t.r=e.r:t.l=e.r}else{let t=null!=r.l?r.l:r.r;null===n?e.root=t:n.l===r?n.l=t:n.r=t}})()}(e,r);return}n.v.splice(n.v.indexOf(t),1)}}(d,c,o),!0;case"Bool":{let e=d[o?"true":"false"].indexOf(c);return d[o?"true":"false"].splice(e,1),!0}case"Radix":{let i=await s.tokenize(o,l,r);for(let o of(await e.removeDocumentScoreParameters(t,r,n,u),i))await e.removeTokenScoreParameters(t,r,o),function(e,t,r,n=!0){if(!t)return;let o=t.length;for(let i=0;i<o;i++){let o=t[i];if(!(o in e.c))return!1;{let a=e.c[o];i+=a.s.length-1,e=a,n&&e.w!==t||function(e,t){let r=e.d.indexOf(t);-1!==r&&e.d.splice(r,1)}(e,r)}}}(d,o,c);return!0}case"Flat":var h,p;return null==d||d.numberToDocumentId.set(o,(null===(h=null==d?void 0:d.numberToDocumentId.get(o))||void 0===h?void 0:h.filter(e=>e!==c))??[]),(null===(p=null==d?void 0:d.numberToDocumentId.get(o))||void 0===p?void 0:p.length)===0&&(null==d||d.numberToDocumentId.delete(o)),!0;case"BKD":return!function(e,t,r){let n=e.root,o=0,i=null,a=null;for(;null!==n;){if((null==n?void 0:n.point.lon)===t.lon&&n.point.lat===t.lat){var l,s;let t=null===(l=n.docIDs)||void 0===l?void 0:l.indexOf(r);if(void 0!==t&&t>-1){null===(s=n.docIDs)||void 0===s||s.splice(t,1),(null==n.docIDs||0===n.docIDs.length)&&(null!=i?"left"===a?i.left=null!==n.left?n.left:n.right:"right"===a&&(i.right=null!==n.right?n.right:n.left):e.root=null!==n.left?n.left:n.right);return}}let u=o%2;i=n,0===u?t.lon<n.point.lon?(n=null==n?void 0:n.left,a="left"):(n=null==n?void 0:n.right,a="right"):t.lat<n.point.lat?(n=null==n?void 0:n.left,a="left"):(n=null==n?void 0:n.right,a="right"),o++}}(d,o,c),!1}}async function e7(e,t,r,n,o,i,a,l,s){if(!em(i))return e9(e,t,r,n,o,i,a,l,s);let u=ep[i],c=o.length;for(let i=0;i<c;i++)await e9(e,t,r,n,o[i],u,a,l,s);return!0}async function e2(e,t,r,n){if(!(r in t.tokenOccurrences))return[];let{node:o,type:i}=t.indexes[r];if("Radix"!==i)throw x("WRONG_SEARCH_PROPERTY_TYPE",r);let{exact:a,tolerance:l}=e.params,s=eG(o,{term:n,exact:a,tolerance:l}),u=new Set;for(let e in s)if(S(s,e))for(let t of s[e])u.add(t);return e.index.calculateResultScores(e,t,r,n,Array.from(u))}async function e5(e,t,r){let n=Object.keys(r),o=n.reduce((e,t)=>({[t]:[],...e}),{});for(let i of n){let n=r[i];if(void 0===t.indexes[i])throw x("UNKNOWN_FILTER_PROPERTY",i);let{node:a,type:l,isArray:s}=t.indexes[i];if("Bool"===l){let e=a[n.toString()];y(o[i],e);continue}if("BKD"===l){let e;if("radius"in n)e="radius";else if("polygon"in n)e="polygon";else throw Error(`Invalid operation ${n}`);if("radius"===e){let{value:t,coordinates:r,unit:l="m",inside:s=!0,highPrecision:u=!1}=n[e],c=function(e,t){let r=k[t];if(void 0===r)throw Error(x("INVALID_DISTANCE_SUFFIX",e).message);return e*r}(t,l),f=function(e,t,r,n=!0,o="asc",i=!1){let a=i?eK:eq,l=[{node:e,depth:0}],s=[];for(;l.length>0;){let{node:e,depth:o}=l.pop();if(null===e)continue;let i=a(t,e.point);(n?i<=r:i>r)&&s.push({point:e.point,docIDs:e.docIDs??[]}),null!=e.left&&l.push({node:e.left,depth:o+1}),null!=e.right&&l.push({node:e.right,depth:o+1})}return o&&s.sort((e,r)=>{let n=a(t,e.point),i=a(t,r.point);return"asc"===o.toLowerCase()?n-i:i-n}),s}(a.root,r,c,s,void 0,u);y(o[i],f.flatMap(({docIDs:e})=>e))}else{let{coordinates:t,inside:r=!0,highPrecision:l=!1}=n[e],s=function(e,t,r=!0,n=null,o=!1){let i=[{node:e,depth:0}],a=[];for(;i.length>0;){let e=i.pop();if(null==e||null==e.node)continue;let{node:n,depth:o}=e,l=o+1;null!=n.left&&i.push({node:n.left,depth:l}),null!=n.right&&i.push({node:n.right,depth:l});let s=function(e,t){let r=!1,n=t.lon,o=t.lat,i=e.length;for(let t=0,a=i-1;t<i;a=t++){let i=e[t].lon,l=e[t].lat,s=e[a].lon,u=e[a].lat;l>o!=u>o&&n<(s-i)*(o-l)/(u-l)+i&&(r=!r)}return r}(t,n.point);s&&r?a.push({point:n.point,docIDs:n.docIDs??[]}):s||r||a.push({point:n.point,docIDs:n.docIDs??[]})}let l=function(e){let t=0,r=0,n=0,o=e.length;for(let i=0,a=o-1;i<o;a=i++){let o=e[i].lon,l=e[i].lat,s=e[a].lon,u=e[a].lat,c=o*u-s*l;t+=c,r+=(o+s)*c,n+=(l+u)*c}let i=6*(t/=2);return{lon:r/=i,lat:n/=i}}(t);if(n){let e=o?eK:eq;a.sort((t,r)=>{let o=e(l,t.point),i=e(l,r.point);return"asc"===n.toLowerCase()?o-i:i-o})}return a}(a.root,t,r,void 0,l);y(o[i],s.flatMap(({docIDs:e})=>e))}continue}if("Radix"===l&&("string"==typeof n||Array.isArray(n))){for(let t of[n].flat())for(let r of(await e.tokenizer.tokenize(t,e.language,i))){let e=eG(a,{term:r,exact:!0});y(o[i],Object.values(e).flat())}continue}let u=Object.keys(n);if(u.length>1)throw x("INVALID_FILTER_OPERATION",u.length);if("Flat"===l){let e=s?eL:eC;y(o[i],e(a,n));continue}if("AVL"===l){let e=u[0],t=n[e],r=[];switch(e){case"gt":r=eR(a,t,!1);break;case"gte":r=eR(a,t,!0);break;case"lt":r=eP(a,t,!1);break;case"lte":r=eP(a,t,!0);break;case"eq":r=function(e,t){let r=eM(e.root,t);return null===r?null:r.v}(a,t)??[];break;case"between":{let[e,n]=t;r=function(e,t,r){let n=[];return!function e(o){null!==o&&(t<o.k&&e(o.l),o.k>=t&&o.k<=r&&y(n,o.v),r>o.k&&e(o.r))}(e.root),n}(a,e,n)}}y(o[i],r)}}return O(Object.values(o))}async function e6(e){return e.searchableProperties}async function e8(e){return e.searchablePropertiesWithTypes}async function e3(e,t){let{indexes:r,vectorIndexes:n,searchableProperties:o,searchablePropertiesWithTypes:i,frequencies:a,tokenOccurrences:l,avgFieldLength:s,fieldLengths:u}=t,c={},f={};for(let e of Object.keys(r)){let{node:t,type:n,isArray:o}=r[e];switch(n){case"Radix":c[e]={type:"Radix",node:function e(t){let r=eY(t.e,t.s,t.k);for(let n of(r.d=t.d,r.w=t.w,Object.keys(t.c)))r.c[n]=e(t.c[n]);return r}(t),isArray:o};break;case"Flat":c[e]={type:"Flat",node:{numberToDocumentId:new Map(t)},isArray:o};break;default:c[e]=r[e]}}for(let e of Object.keys(n)){let t=n[e].vectors;for(let e in t)t[e]=[t[e][0],new Float32Array(t[e][1])];f[e]={size:n[e].size,vectors:t}}return{sharedInternalDocumentStore:e,indexes:c,vectorIndexes:f,searchableProperties:o,searchablePropertiesWithTypes:i,frequencies:a,tokenOccurrences:l,avgFieldLength:s,fieldLengths:u}}async function e4(e){let{indexes:t,vectorIndexes:r,searchableProperties:n,searchablePropertiesWithTypes:o,frequencies:i,tokenOccurrences:a,avgFieldLength:l,fieldLengths:s}=e,u={};for(let e of Object.keys(r)){let t=r[e].vectors;for(let e in t)t[e]=[t[e][0],Array.from(t[e][1])];u[e]={size:r[e].size,vectors:t}}let c={};for(let e of Object.keys(t)){let{type:r,node:n,isArray:o}=t[e];if("Flat"!==r){c[e]=t[e];continue}c[e]={type:"Flat",node:Array.from(n.numberToDocumentId.entries()),isArray:o}}return{indexes:c,vectorIndexes:u,searchableProperties:n,searchablePropertiesWithTypes:o,frequencies:i,tokenOccurrences:a,avgFieldLength:l,fieldLengths:s}}async function te(){return{create:e0,insert:e1,remove:e7,insertDocumentScoreParameters:eH,insertTokenScoreParameters:eX,removeDocumentScoreParameters:eZ,removeTokenScoreParameters:eJ,calculateResultScores:eQ,search:e2,searchByWhereClause:e5,getSearchableProperties:e6,getSearchablePropertiesWithTypes:e8,load:e3,save:e4}}async function tt(e,t,r,n){return(null==n?void 0:n.enabled)!==!1?function e(t,r,n,o,i){let a={language:t.tokenizer.language,sharedInternalDocumentStore:r,enabled:!0,isSorted:!0,sortableProperties:[],sortablePropertiesWithTypes:{},sorts:{}};for(let[l,s]of Object.entries(n)){let n=`${i}${i?".":""}${l}`;if(!o.includes(n)){if("object"==typeof s&&!Array.isArray(s)){let i=e(t,r,s,o,n);y(a.sortableProperties,i.sortableProperties),a.sorts={...a.sorts,...i.sorts},a.sortablePropertiesWithTypes={...a.sortablePropertiesWithTypes,...i.sortablePropertiesWithTypes};continue}if(!eg(s))switch(s){case"boolean":case"number":case"string":a.sortableProperties.push(n),a.sortablePropertiesWithTypes[n]=s,a.sorts[n]={docs:new Map,orderedDocsToRemove:new Map,orderedDocs:[],type:s};break;case"geopoint":case"enum":case"enum[]":case"boolean[]":case"number[]":case"string[]":continue;default:throw x("INVALID_SORT_SCHEMA_TYPE",Array.isArray(s)?"array":s,n)}}}return a}(e,t,r,(n||{}).unsortableProperties||[],""):{disabled:!0}}async function tr(e,t,r,n){if(!e.enabled)return;e.isSorted=!1;let o=a(e.sharedInternalDocumentStore,r),i=e.sorts[t];i.orderedDocsToRemove.has(o)&&tl(e,t),i.docs.set(o,i.orderedDocs.length),i.orderedDocs.push([o,n])}function tn(e){if(!e.isSorted&&e.enabled){for(let t of Object.keys(e.sorts))!function(e,t){let r;let n=e.sorts[t];switch(n.type){case"string":r=to.bind(null,e.language);break;case"number":r=ti.bind(null);break;case"boolean":r=ta.bind(null)}n.orderedDocs.sort(r);let o=n.orderedDocs.length;for(let e=0;e<o;e++){let t=n.orderedDocs[e][0];n.docs.set(t,e)}}(e,t);e.isSorted=!0}}function to(e,t,r){return t[1].localeCompare(r[1],void 0!==e&&c.includes(e)?s[e]:void 0)}function ti(e,t){return e[1]-t[1]}function ta(e,t){return t[1]?-1:1}function tl(e,t){let r=e.sorts[t];r.orderedDocsToRemove.size&&(r.orderedDocs=r.orderedDocs.filter(e=>!r.orderedDocsToRemove.has(e[0])),r.orderedDocsToRemove.clear())}async function ts(e,t,r){if(!e.enabled)return;let n=e.sorts[t],o=a(e.sharedInternalDocumentStore,r);n.docs.get(o)&&(n.docs.delete(o),n.orderedDocsToRemove.set(o,!0))}async function tu(e,t,r){if(!e.enabled)throw x("SORT_DISABLED");let n=r.property,o="DESC"===r.order,i=e.sorts[n];if(!i)throw x("UNABLE_TO_SORT_ON_UNKNOWN_FIELD",n,e.sortableProperties.join(", "));return tl(e,n),tn(e),t.sort((t,r)=>{let n=i.docs.get(a(e.sharedInternalDocumentStore,t[0])),l=i.docs.get(a(e.sharedInternalDocumentStore,r[0])),s=void 0!==n,u=void 0!==l;return s||u?s?u?o?l-n:n-l:-1:1:0}),t}async function tc(e){return e.enabled?e.sortableProperties:[]}async function tf(e){return e.enabled?e.sortablePropertiesWithTypes:{}}async function td(e,t){if(!t.enabled)return{enabled:!1};let r=Object.keys(t.sorts).reduce((e,r)=>{let{docs:n,orderedDocs:o,type:i}=t.sorts[r];return e[r]={docs:new Map(Object.entries(n).map(([e,t])=>[+e,t])),orderedDocsToRemove:new Map,orderedDocs:o,type:i},e},{});return{sharedInternalDocumentStore:e,language:t.language,sortableProperties:t.sortableProperties,sortablePropertiesWithTypes:t.sortablePropertiesWithTypes,sorts:r,enabled:!0,isSorted:t.isSorted}}async function th(e){if(!e.enabled)return{enabled:!1};!function(e){for(let t of Object.keys(e.sorts))tl(e,t)}(e),tn(e);let t=Object.keys(e.sorts).reduce((t,r)=>{let{docs:n,orderedDocs:o,type:i}=e.sorts[r];return t[r]={docs:Object.fromEntries(n.entries()),orderedDocs:o,type:i},t},{});return{language:e.language,sortableProperties:e.sortableProperties,sortablePropertiesWithTypes:e.sortablePropertiesWithTypes,sorts:t,enabled:e.enabled,isSorted:e.isSorted}}async function tp(){return{create:tt,insert:tr,remove:ts,save:th,load:td,sortBy:tu,getSortableProperties:tc,getSortablePropertiesWithTypes:tf}}let tg=[65,65,65,65,65,65,65,67,69,69,69,69,73,73,73,73,69,78,79,79,79,79,79,null,79,85,85,85,85,89,80,115,97,97,97,97,97,97,97,99,101,101,101,101,105,105,105,105,101,110,111,111,111,111,111,null,111,117,117,117,117,121,112,121,65,97,65,97,65,97,67,99,67,99,67,99,67,99,68,100,68,100,69,101,69,101,69,101,69,101,69,101,71,103,71,103,71,103,71,103,72,104,72,104,73,105,73,105,73,105,73,105,73,105,73,105,74,106,75,107,107,76,108,76,108,76,108,76,108,76,108,78,110,78,110,78,110,110,78,110,79,111,79,111,79,111,79,111,82,114,82,114,82,114,83,115,83,115,83,115,83,115,84,116,84,116,84,116,85,117,85,117,85,117,85,117,85,117,85,117,87,119,89,121,89,90,122,90,122,90,122,115],tm={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},ty={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},tb="[aeiouy]",tI="[^aeiou][^aeiouy]*",tw=tb+"[aeiou]*",tv="^("+tI+")?"+tw+tI,tS="^("+tI+")?"+tw+tI+"("+tw+")?$",tT="^("+tI+")?"+tw+tI+tw+tI,tO="^("+tI+")?"+tb;function tD(e){let t,r,n,o,i,a;if(e.length<3)return e;let l=e.substring(0,1);if("y"==l&&(e=l.toUpperCase()+e.substring(1)),o=/^(.+?)([^s])s$/,(n=/^(.+?)(ss|i)es$/).test(e)?e=e.replace(n,"$1$2"):o.test(e)&&(e=e.replace(o,"$1$2")),o=/^(.+?)(ed|ing)$/,(n=/^(.+?)eed$/).test(e)){let t=n.exec(e);(n=new RegExp(tv)).test(t[1])&&(n=/.$/,e=e.replace(n,""))}else o.test(e)&&(t=o.exec(e)[1],(o=new RegExp(tO)).test(t)&&(e=t,o=/(at|bl|iz)$/,i=RegExp("([^aeiouylsz])\\1$"),a=RegExp("^"+tI+tb+"[^aeiouwxy]$"),o.test(e)?e+="e":i.test(e)?(n=/.$/,e=e.replace(n,"")):a.test(e)&&(e+="e")));if((n=/^(.+?)y$/).test(e)){let r=n.exec(e);t=null==r?void 0:r[1],n=new RegExp(tO),t&&n.test(t)&&(e=t+"i")}if((n=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/).test(e)){let o=n.exec(e);t=null==o?void 0:o[1],r=null==o?void 0:o[2],n=new RegExp(tv),t&&n.test(t)&&(e=t+tm[r])}if((n=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/).test(e)){let o=n.exec(e);t=null==o?void 0:o[1],r=null==o?void 0:o[2],n=new RegExp(tv),t&&n.test(t)&&(e=t+ty[r])}if(o=/^(.+?)(s|t)(ion)$/,(n=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/).test(e)){let r=n.exec(e);t=null==r?void 0:r[1],n=new RegExp(tT),t&&n.test(t)&&(e=t)}else if(o.test(e)){let r=o.exec(e);t=(null==r?void 0:r[1])??""+(null==r?void 0:r[2])??"",(o=new RegExp(tT)).test(t)&&(e=t)}if((n=/^(.+?)e$/).test(e)){let r=n.exec(e);t=null==r?void 0:r[1],n=new RegExp(tT),o=new RegExp(tS),i=RegExp("^"+tI+tb+"[^aeiouwxy]$"),t&&(n.test(t)||o.test(t)&&!i.test(t))&&(e=t)}return n=/ll$/,o=new RegExp(tT),n.test(e)&&o.test(e)&&(n=/.$/,e=e.replace(n,"")),"y"==l&&(e=l.toLowerCase()+e.substring(1)),e}function t_(e,t){var r;let n=`${this.language}:${e}:${t}`;return this.normalizationCache.has(n)?this.normalizationCache.get(n):(null===(r=this.stopWords)||void 0===r?void 0:r.includes(t))?(this.normalizationCache.set(n,""),""):(this.stemmer&&!this.stemmerSkipProperties.has(e)&&(t=this.stemmer(t)),t=function(e){let t=[];for(let n=0;n<e.length;n++){var r;t[n]=(r=e.charCodeAt(n))<192||r>383?r:tg[r-192]||r}return String.fromCharCode(...t)}(t),this.normalizationCache.set(n,t),t)}function tk(e,t,r){let n;if(t&&t!==this.language)throw x("LANGUAGE_NOT_SUPPORTED",t);if("string"!=typeof e)return[e];if(r&&this.tokenizeSkipProperties.has(r))n=[this.normalizeToken.bind(this,r??"")(e)];else{let t=u[this.language];n=e.toLowerCase().split(t).map(this.normalizeToken.bind(this,r??"")).filter(Boolean)}let o=function(e){for(;""===e[e.length-1];)e.pop();for(;""===e[0];)e.shift();return e}(n);return this.allowDuplicates?o:Array.from(new Set(o))}async function tE(e={}){let t,r;if(e.language){if(!c.includes(e.language))throw x("LANGUAGE_NOT_SUPPORTED",e.language)}else e.language="english";if(e.stemming||e.stemmer&&!("stemming"in e)){if(e.stemmer){if("function"!=typeof e.stemmer)throw x("INVALID_STEMMER_FUNCTION_TYPE");t=e.stemmer}else if("english"===e.language)t=tD;else throw x("MISSING_STEMMER",e.language)}if(!1!==e.stopWords){if(r=[],Array.isArray(e.stopWords))r=e.stopWords;else if("function"==typeof e.stopWords)r=await e.stopWords(r);else if(e.stopWords)throw x("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");if(!Array.isArray(r))throw x("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");for(let e of r)if("string"!=typeof e)throw x("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY")}let n={tokenize:tk,language:e.language,stemmer:t,stemmerSkipProperties:new Set(e.stemmerSkipProperties?[e.stemmerSkipProperties].flat():[]),tokenizeSkipProperties:new Set(e.tokenizeSkipProperties?[e.tokenizeSkipProperties].flat():[]),stopWords:r,allowDuplicates:!!e.allowDuplicates,normalizeToken:t_,normalizationCache:new Map};return n.tokenize=tk.bind(n),n.normalizeToken=t_,n}async function tN({schema:e,sort:t,language:r,components:n,id:a,plugins:l}){n||(n={}),a||(a=await v());let s=n.tokenizer,u=n.index,c=n.documentsStore,f=n.sorter;if(s=s?s.tokenize?s:await tE(s):await tE({language:r??"english"}),n.tokenizer&&r)throw x("NO_LANGUAGE_WITH_CUSTOM_TOKENIZER");let d={idToInternalId:new Map,internalIdToId:[],save:o,load:i};u||=await te(),f||=await tp(),c||=await ek(),function(e){let t={formatElapsedTime:ec,getDocumentIndexId:ef,getDocumentProperties:D,validateSchema:ed};for(let r of $)if(e[r]){if("function"!=typeof e[r])throw x("COMPONENT_MUST_BE_FUNCTION",r)}else e[r]=t[r];for(let t of Object.keys(e))if(!F.includes(t)&&!$.includes(t))throw x("UNSUPPORTED_COMPONENT",t)}(n);let{getDocumentProperties:h,getDocumentIndexId:p,validateSchema:g,formatElapsedTime:m}=n,y={data:{},caches:{},schema:e,tokenizer:s,index:u,sorter:f,documentsStore:c,internalDocumentIDStore:d,getDocumentProperties:h,getDocumentIndexId:p,validateSchema:g,beforeInsert:[],afterInsert:[],beforeRemove:[],afterRemove:[],beforeUpdate:[],afterUpdate:[],beforeSearch:[],afterSearch:[],beforeInsertMultiple:[],afterInsertMultiple:[],beforeRemoveMultiple:[],afterRemoveMultiple:[],afterUpdateMultiple:[],beforeUpdateMultiple:[],afterCreate:[],formatElapsedTime:m,id:a,plugins:l,version:"2.1.1"};for(let r of(y.data={index:await y.index.create(y,d,e),docs:await y.documentsStore.create(y,d),sorting:await y.sorter.create(y,d,e,t)},eE))y[r]=(y[r]??[]).concat(await eN(y,r));let b=y.afterCreate;return b&&await q(b,y),y}async function tA(e,t){e.internalDocumentIDStore.load(e,t.internalDocumentIDStore),e.data.index=await e.index.load(e.internalDocumentIDStore,t.index),e.data.docs=await e.documentsStore.load(e.internalDocumentIDStore,t.docs),e.data.sorting=await e.sorter.load(e.internalDocumentIDStore,t.sorting),e.tokenizer.language=t.language}function tx({from:e="/api/search"}){let t=new Map,r=async function(){let r=await fetch(e);if(!r.ok)throw Error(`failed to fetch exported search indexes from ${e}, make sure the search database is exported and available for client.`);let n=await r.json();if("i18n"===n.type)for(let[e,r]of Object.entries(n.data)){let n=await tN({schema:{_:"string"}});await tA(n,r),t.set(e,{type:r.type,db:n})}else{let e=await tN({schema:{_:"string"}});await tA(e,n),t.set("",{type:n.type,db:e})}}();return{async search(e,n,o){await r;let i=t.get(n??"");return i?"simple"===i.type?es(i,e):eu(i.db,e,o):[]}}}}}]);